# Исправление фильтрации по категориям и подкатегориям

## Проблемы которые были исправлены

### 1. Ошибка 412 при фильтрации по цене
**Причина:** API МойСклад не поддерживает фильтрацию по вложенным полям массивов (`salePrices.value`)

**Решение:** Перенесли фильтрацию по цене на клиентскую сторону в `useMoySkladProducts.ts`

### 2. Товары из подкатегорий не показывались в основной категории
**Причина:** Фильтрация работала только по точному совпадению имени категории

**Решение:** 
- Добавили поле `pathName` в интерфейс `Product` для хранения полного пути категории
- Обновили логику фильтрации чтобы при выборе основной категории показывались товары из всех её подкатегорий
- Используем проверку: `pathName === category` или `pathName.startsWith(category + '/')`

### 3. Неправильный подсчет товаров в подкатегориях
**Причина:** Загружалось слишком мало товаров (9 штук) для правильного подсчета

**Решение:**
- Увеличили размер страницы до 50 товаров для основных категорий
- Для подкатегорий оставили 9 товаров (для быстрой загрузки)
- Добавили подсчет товаров в каждой подкатегории на основе `pathName`

## Измененные файлы

### 1. `/src/lib/moysklad.ts`
- Добавлено поле `pathName` в возвращаемый объект `transformMoySkladProduct()`

### 2. `/src/hooks/useMoySkladProducts.ts`
- Добавлено поле `pathName` в интерфейс `Product`
- Убрана фильтрация по цене из API запроса (строка 74-87)
- Добавлена клиентская фильтрация по цене (строка 180-187)
- Улучшена логика фильтрации по категориям с использованием `pathName` (строка 135-171)

### 3. `/src/pages/Category.tsx`
- Увеличен размер страницы для основных категорий до 50 товаров (строка 98)
- Добавлен подсчет товаров в подкатегориях (строка 137-148)

## Как это работает теперь

### При выборе основной категории (например "Электроника"):
1. Загружается 50 товаров из категории
2. Фильтруются все товары где `pathName` начинается с "Электроника" или равен "Электроника"
3. Это включает товары из:
   - Самой категории "Электроника" 
   - Подкатегорий "Электроника/Телефоны"
   - Подкатегорий "Электроника/Ноутбуки"
   - И т.д.
4. Показываются подкатегории с количеством товаров в каждой

### При выборе подкатегории (например "Телефоны"):
1. Загружается 9 товаров для быстрой загрузки
2. Фильтруются только товары из этой конкретной подкатегории
3. Можно загрузить еще товары кнопкой "Загрузить еще"

## Тестирование

Для проверки работы:
1. Откройте любую основную категорию - должны показаться все товары из неё и подкатегорий
2. Кликните на подкатегорию - должны показаться только товары из этой подкатегории
3. Попробуйте фильтр по цене - должен работать без ошибок 412
4. Проверьте количество товаров в подкатегориях - должно совпадать с реальным количеством
